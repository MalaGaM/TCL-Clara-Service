<html>
<head><title>ClaraServ.tcl</title></head>
<body bgcolor="#ffffff">
<font size="-2">
Index by:  <a href="index_main.html#ClaraServ.tcl">file name</a> |
<a href="index_main.html#byprocname">procedure name</a> |
<a href="index_main.html#bycall">procedure call</a> |
<a href="index_annot_full.html">annotation</a>
</font>
<hr>
<strong>ClaraServ.tcl</strong>
(<a href="ClaraServ.tcl-annot.html">annotations</a> | <a href="ClaraServ.tcl.txt">original source</a>)
<p>
<pre>
<font color="#208020">#############################################################################</font>
<font color="#208020">#  ██████╗██╗      █████╗ ██████╗  █████╗ ███████╗███████╗██████╗ ██╗   ██╗ #</font>
<font color="#208020"># ██╔════╝██║     ██╔══██╗██╔══██╗██╔══██╗██╔════╝██╔════╝██╔══██╗██║   ██║ #</font>
<font color="#208020"># ██║     ██║     ███████║██████╔╝███████║███████╗█████╗  ██████╔╝██║   ██║ #</font>
<font color="#208020"># ██║     ██║     ██╔══██║██╔══██╗██╔══██║╚════██║██╔══╝  ██╔══██╗╚██╗ ██╔╝ #</font>
<font color="#208020"># ╚██████╗███████╗██║  ██║██║  ██║██║  ██║███████║███████╗██║  ██║ ╚████╔╝  #</font>
<font color="#208020">#  ╚═════╝╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝  ╚═══╝   #</font>
<font color="#208020">#############################################################################</font>
<font color="#208020">#</font>
<font color="#208020">#	Auteur	:</font>
<font color="#208020">#		-&gt; ZarTek (ZarTek.Creole@GMail.Com)</font>
<font color="#208020">#</font>
<font color="#208020">#	Website	:</font>
<font color="#208020">#		-&gt; github.com/ZarTek-Creole/TCL-ClaraServ</font>
<font color="#208020">#</font>
<font color="#208020">#	Support	:</font>
<font color="#208020">#		-&gt; github.com/ZarTek-Creole/TCL-ClaraServ/issues</font>
<font color="#208020">#</font>
<font color="#208020">#	Docs	:</font>
<font color="#208020">#		-&gt; github.com/ZarTek-Creole/TCL-ClaraServ/wiki</font>
<font color="#208020">#</font>
<font color="#208020">#   DONATE   :</font>
<font color="#208020">#       -&gt; https://github.com/ZarTek-Creole/DONATE</font>
<font color="#208020">#</font>
<font color="#208020">#	LICENSE :</font>
<font color="#208020">#		-&gt; Creative Commons Attribution 4.0 International</font>
<font color="#208020">#		-&gt; github.com/ZarTek-Creole/TCL-ClaraServ/blob/main/LICENSE.txt</font>
<font color="#208020">#</font>
<font color="#208020">#	Greet	:</font>
<font color="#208020">#		-&gt; Chris et Yeh pour versions antérieures</font>
<font color="#208020">#		-&gt; Amandine de www.eggdrop.fr pour les testes, les idées, ...</font>
<font color="#208020">#		-&gt; MenzAgitat de www.eggdrop.fr pour ses astuces/conseils</font>
<font color="#208020">#</font>
<font color="#208020">#############################################################################</font>

namespace eval ClaraServ {
	variable config
	variable UID_DB
	variable CONNECT_ID
	variable BOT_ID
	variable DIR
	variable SCRIPT

	set DIR(CUR)			[file dirname [file dirname [file normalize [file join [info script] ...]]]]
	set CONNECT_ID			{}
	set BOT_ID				{}
	array set SCRIPT {
		&quot;name&quot;		&quot;ClaraServ Service&quot;
		&quot;version&quot;	&quot;1.1.3&quot;
		&quot;auteur&quot;	&quot;ZarTek&quot;
		&quot;need_zct&quot;	&quot;0.0.6&quot;
		&quot;need_ircs&quot;	&quot;0.0.5&quot;
	}
	set config(path_script)	[file dirname [info script]];

	set config(db_list)		[list \
		&quot;salon.db&quot;
	];

	set config(vars_list)	[list	\
		&quot;uplink_host&quot;		\
		&quot;uplink_port&quot;		\
		&quot;uplink_password&quot;	\
		&quot;serverinfo_name&quot;	\
		&quot;serverinfo_descr&quot;	\
		&quot;serverinfo_id&quot;		\
		&quot;uplink_useprivmsg&quot;	\
		&quot;uplink_debug&quot;		\
		&quot;service_nick&quot;		\
		&quot;service_user&quot;		\
		&quot;service_host&quot;		\
		&quot;service_gecos&quot;		\
		&quot;service_modes&quot;		\
		&quot;service_channel&quot;	\
		&quot;service_chanmodes&quot;	\
		&quot;service_usermodes&quot;	\
		&quot;admin_password&quot;	\
		&quot;db_lang&quot;			\
		&quot;admin_console&quot;		\
		&quot;db_lang&quot;
	];
	<font color="#208020"># Verification si le package ZCT a été mis dans le projet courant et si oui  le sourcé(charger)</font>
	if { [file exists ${DIR(CUR)}/modules/TCL-ZCT/ZCT.tcl] &amp;&amp; [catch { source ${DIR(CUR)}/modules/TCL-ZCT/ZCT.tcl  } err] } { die &quot;\[${SCRIPT(name)} - Erreur\] Chargement '${DIR(CUR)}/modules/TCL-ZCT/ZCT.tcl' à échoué: ${err}&quot;; }
	<font color="#208020"># Necesite le package ZCT, tentative de chargment de celui-ci</font>
	if { [catch { package require ZCT ${SCRIPT(need_zct)} } err] } { die &quot;\[${SCRIPT(name)} - Erreur\] Nécessite le package ZCT ${SCRIPT(need_zct)} (ou supérieur) pour fonctionner.\nLe chargement du script a été annulé.\nTélécharger-le sur 'https://github.com/ZarTek-Creole/TCL-ZCT'.\n${err}&quot; ; }
	<font color="#208020"># Importation des fonctions de ZTC</font>
	namespace import -force ::ZCT::*


	<font color="#208020"># Verification si le package ZCT a été mis dans le projet courant et si oui  le sourcé(charger)</font>
	if {
		[file exists ${DIR(CUR)}/modules/TCL-PKG-IRCServices/ircservices.tcl] &amp;&amp; \
			[catch { source ${DIR(CUR)}/modules/TCL-PKG-IRCServices/ircservices.tcl } err]
	} {
		die &quot;\[${SCRIPT(name)} - Erreur\] Chargement '${DIR(CUR)}/modules/TCL-PKG-IRCServices/ircservices.tcl' à échoué: ${err}&quot;;
	}
	<font color="#208020"># Necesite le package ZCT, tentative de chargment de celui-ci via la fct de ZCT</font>
	pkg load IRCServices ${SCRIPT(need_ircs)} ${SCRIPT(name)}

	if {[info commands ::ClaraServ::uninstall] eq &quot;::ClaraServ::uninstall&quot; } { ::ClaraServ::uninstall }
	namespace eval FCT {
		namespace export CONNECT_ID
		namespace export BOT_ID
		namespace import -force ::ZCT::*

	}
	<strong><a name="uninstall_107">proc <a href="ClaraServ.tcl-annot.html#uninstall">uninstall</a></a></strong><a name="uninstall"></a> {args} {
		variable config
		variable SCRIPT

		putlog &quot;Désallocation des ressources de \002[set SCRIPT(name)]\002...&quot;

		foreach binding [lsearch -inline -all -regexp [binds *[set ns [::tcl::string::range [namespace current] 2 end]]*] &quot; \{?(::)?${ns}&quot;] {
			unbind [lindex ${binding} 0] [lindex ${binding} 1] [lindex ${binding} 2] [lindex ${binding} 4]
		}
		<font color="#208020"># Arrêt des timers en cours.</font>
		foreach running_timer [timers] {
			if { [::tcl::string::match &quot;*[namespace current]::*&quot; [lindex ${running_timer} 1]] } { killtimer [lindex ${running_timer} 2] }
		}
		namespace delete ::ClaraServ
	}
}
<strong><a name="::ClaraServ::INIT_123">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::INIT">::ClaraServ::INIT</a></a></strong><a name="::ClaraServ::INIT"></a> { } {
	variable config
	variable database
	variable SCRIPT
	<font color="#208020">#################</font>
	<font color="#208020"># ClaraServ Fichier #</font>
	<font color="#208020">#################</font>
	if { ![file isdirectory &quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]&quot;] } { file mkdir &quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]&quot; }

	<font color="#208020">################</font>
	<font color="#208020"># ClaraServ Source #</font>
	<font color="#208020">################</font>
	if { [file exists [<a name="::ClaraServ::FCT::Get:ScriptDir(3)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a>]ClaraServ.conf] } {
		if { [ catch { source [<a name="::ClaraServ::FCT::Get:ScriptDir(4)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a>]ClaraServ.conf } err ] } {
			putlog &quot;\[ Erreur \] Probleme de chargement de '[<a name="::ClaraServ::FCT::Get:ScriptDir(5)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a>]ClaraServ.conf': ${err}&quot;
			exit
		}
		<a name="::ClaraServ::FCT::Check:Config(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Check:Config_177">::ClaraServ::FCT::Check:Config</a></a>
	} else {
		if { [file exists [<a name="::ClaraServ::FCT::Get:ScriptDir(6)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a>]ClaraServ.Example.conf] } {
			putlog &quot;Editez, configurer et renomer 'ClaraServ.Example.conf' en 'ClaraServ.conf' dans '[<a name="::ClaraServ::FCT::Get:ScriptDir(7)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a>]'&quot;
			exit
		} else {
			putlog &quot;Fichier de configuration '[<a name="::ClaraServ::FCT::Get:ScriptDir(8)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a>]ClaraServ.conf' manquant.&quot;
			exit
		}
	}

	set config(FILE_DB)	&quot;database.[string tolower ${config(db_lang)}].db&quot;
	<font color="#208020"># generer les db si elle n'existe pas</font>
	<a name="::ClaraServ::FCT::DB:INIT(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:INIT_256">::ClaraServ::FCT::DB:INIT</a></a> [list  {*}${config(db_list)} {*}${config(FILE_DB)}]

	if { [file exists [<a name="::ClaraServ::FCT::Get:ScriptDir(9)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/${config(FILE_DB)}] } {
		if { [ catch { source [<a name="::ClaraServ::FCT::Get:ScriptDir(10)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/${config(FILE_DB)} } err ] } {
			putlog &quot;\[ Erreur \] Probleme de chargement de '[<a name="::ClaraServ::FCT::Get:ScriptDir(11)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/${config(FILE_DB)}': ${err}&quot;
			exit
		}
	} else {
		putlog &quot;Fichier de base de données '[<a name="::ClaraServ::FCT::Get:ScriptDir(12)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/${config(FILE_DB)}' manquant.&quot;
		exit
	}

	if { ![info exists config(idx)] } { <a name="::ClaraServ::FCT::Socket:Connexion(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Socket:Connexion_336">::ClaraServ::FCT::Socket:Connexion</a></a> }
	putlog &quot;\[[set SCRIPT(name)] - Chargement\]\003 v[set SCRIPT(version)] par [set SCRIPT(auteur)] charger.&quot;
}

<font color="#208020">###################</font>
<font color="#208020"># ClaraServ fonctions #</font>
<font color="#208020">###################</font>
<strong><a name="::ClaraServ::FCT::Get:ScriptDir_172">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::Get:ScriptDir">::ClaraServ::FCT::Get:ScriptDir</a></a></strong><a name="::ClaraServ::FCT::Get:ScriptDir"></a> { {DIR &quot;&quot;} } {
	global ::ClaraServ::config
	return &quot;[file normalize ${config(path_script)}/${DIR}]/&quot;
}

<strong><a name="::ClaraServ::FCT::Check:Config_177">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::Check:Config">::ClaraServ::FCT::Check:Config</a></a></strong><a name="::ClaraServ::FCT::Check:Config"></a> { } {
	global ::ClaraServ::config
	foreach CONF ${config(vars_list)} {
		if { ![info exists config($CONF)] } {
			putlog &quot;\[ Erreur \] Configuration de ClaraServ Service Incorrecte... '${CONF}' Paramettre manquant&quot;
			exit
		}
		if { $config($CONF) == &quot;&quot; } {
			putlog &quot;\[ Erreur \] Configuration de ClaraServ Service Incorrecte... '${CONF}' Valeur vide&quot;
			exit
		}
	}
}

<strong><a name="::ClaraServ::FCT::substitute_special_vars_2nd_pass_191">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::substitute_special_vars_2nd_pass">::ClaraServ::FCT::substitute_special_vars_2nd_pass</a></a></strong><a name="::ClaraServ::FCT::substitute_special_vars_2nd_pass"></a> {chan text} {
	global ::ClaraServ::config
	regsub -all {%chan%}		${text} ${chan} text;
	regsub -all %botnick%		${text} [regsub -all {\W} ${config(service_nick)} {\\&amp;}] text;
	regsub -all %hour%			${text} [set hour [strftime %H [unixtime]]] text;
	regsub -all %hour_short%	${text} [if { ${hour} != 00 } { set dummy [string trimleft ${hour} 0] } { set dummy 0 }] text
	regsub -all %minutes%		${text} [set minutes [strftime %M [unixtime]]] text
	regsub -all %minutes_short%	${text} [if { ${minutes} != 00 } { set dummy [string trimleft ${minutes} 0] } { set dummy 0 }] text
	regsub -all %seconds%		${text} [set seconds [strftime %S [unixtime]]] text
	regsub -all %seconds_short%	${text} [if { ${seconds} != 00 } { set dummy [string trimleft ${seconds} 0] } { set dummy 0 }] text
	regsub -all %day_num%		${text} [strftime %d [unixtime]] text
	regsub -all %day%			${text} [string map -nocase {Mon lundi Tue mardi Wed mercredi Thu jeudi Fri vendredi Sat samedi Sun dimanche} [strftime &quot;%a&quot; [unixtime]]] text
	regsub -all %month_num%		${text} [strftime %m [unixtime]] text
	regsub -all %month%			${text} [string map {Jan janvier Feb février Mar mars Apr avril May mai Jun juin Jul juillet Aou août Sep septembre Oct octobre Nov novembre Dec décembre} [strftime %b [unixtime]]] text
	regsub -all %year%			${text} [strftime %Y [unixtime]] text
	return ${text}
}
<strong><a name="::ClaraServ::FCT::DB:GET_208">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::DB:GET">::ClaraServ::FCT::DB:GET</a></a></strong><a name="::ClaraServ::FCT::DB:GET"></a> { CMD NIVEAU } {
	global ::ClaraServ::database
	foreach index [lsearch -all -nocase ${database} &quot;*${CMD}*&quot;] {
		set index_data	[lindex ${database} ${index}]
		set type		[lindex ${index_data} 1]
		set data		[lindex ${index_data} 2]
		if { ${type} == ${NIVEAU} } {
			return ${data}
		}
	}
	return -1
}
<strong><a name="::ClaraServ::FCT::DB:CMD:LIST_220">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::DB:CMD:LIST">::ClaraServ::FCT::DB:CMD:LIST</a></a></strong><a name="::ClaraServ::FCT::DB:CMD:LIST"></a> { } {
	global ::ClaraServ::database
	set ltext		[llength ${database}];
	set text		[lindex ${database} 0];
	set CMD_LIST	[list];
	set x			0;
	while { ${x} &lt; ${ltext} } {
		lappend CMD_LIST [lindex [lindex ${database} ${x}] 0]
		incr x
	}
	return [lsort -unique ${CMD_LIST}]
}

<strong><a name="::ClaraServ::FCT::SENT:NOTICE_233">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::SENT:NOTICE">::ClaraServ::FCT::SENT:NOTICE</a></a></strong><a name="::ClaraServ::FCT::SENT:NOTICE"></a> { DEST MSG } {
	variable BOT_ID
	${BOT_ID}	notice ${DEST} [::ZCT::TXT::visuals::apply ${MSG} ]
}

<strong><a name="::ClaraServ::FCT::SENT:PRIVMSG_238">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::SENT:PRIVMSG">::ClaraServ::FCT::SENT:PRIVMSG</a></a></strong><a name="::ClaraServ::FCT::SENT:PRIVMSG"></a> { DEST MSG } {
	variable BOT_ID
	${BOT_ID}	privmsg ${DEST} [::ZCT::TXT::visuals::apply ${MSG} ]
}
<strong><a name="::ClaraServ::FCT::SENT:MSG:TO:USER_242">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::SENT:MSG:TO:USER">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a></strong><a name="::ClaraServ::FCT::SENT:MSG:TO:USER"></a> { DEST MSG } {
	global ::ClaraServ::config
	variable BOT_ID
	if { ${config(uplink_useprivmsg)} == 1 } {
		<a name="::ClaraServ::FCT::SENT:PRIVMSG(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:PRIVMSG_238">::ClaraServ::FCT::SENT:PRIVMSG</a></a> ${DEST} ${MSG} ;
	} else {
		SNOTICE ${BOT_ID} ${DEST} ${MSG} ;
	}
}
<strong><a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a></strong><a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG"></a> { MSG } {
	global ::ClaraServ::config
	<a name="::ClaraServ::FCT::SENT:PRIVMSG(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:PRIVMSG_238">::ClaraServ::FCT::SENT:PRIVMSG</a></a> ${config(service_channel)} ${MSG} ;
}

<strong><a name="::ClaraServ::FCT::DB:INIT_256">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::DB:INIT">::ClaraServ::FCT::DB:INIT</a></a></strong><a name="::ClaraServ::FCT::DB:INIT"></a> { LISTDB } {
	foreach DB_FILE_NAME [split ${LISTDB}] {
		if { ![file exists &quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(13)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]${DB_FILE_NAME}&quot;] } {
			set FILE_PIPE	[open &quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(14)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]${DB_FILE_NAME}&quot; a+];
			close ${FILE_PIPE}
		}
	}
}
<strong><a name="::ClaraServ::FCT::CMD:LOG_264">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::CMD:LOG">::ClaraServ::FCT::CMD:LOG</a></a></strong><a name="::ClaraServ::FCT::CMD:LOG"></a> { cmd sender } {
	global ::ClaraServ::config
	if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Commandes :&lt;c04&gt;  ${cmd} &lt;c12&gt;par&lt;c04&gt; ${sender}&quot;  }
}

<strong><a name="::ClaraServ::FCT::CMD:SHOW:LIST_269">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::CMD:SHOW:LIST">::ClaraServ::FCT::CMD:SHOW:LIST</a></a></strong><a name="::ClaraServ::FCT::CMD:SHOW:LIST"></a> { DEST } {
	set max				8;
	set l_espace		13;
	set CMD_LIST		&quot;&quot;
	foreach CMD [<a name="::ClaraServ::FCT::DB:CMD:LIST(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:CMD:LIST_220">::ClaraServ::FCT::DB:CMD:LIST</a></a>] {
		lappend CMD_LIST	&quot;&lt;c04&gt;[::ZCT::TXT::visuals::espace ${CMD} ${l_espace}]&lt;c12&gt;&quot;
		if { [incr i] &gt; ${max}-1 } {
			unset i
			<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${DEST} [join ${CMD_LIST} &quot; | &quot;];
			set CMD_LIST	&quot;&quot;
		}
	}
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${DEST} [join ${CMD_LIST} &quot; | &quot;];
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(3)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${DEST} &quot;&lt;c&gt;&quot;;
}

<strong><a name="::ClaraServ::FCT::DB:DATA:EXIST_285">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::DB:DATA:EXIST">::ClaraServ::FCT::DB:DATA:EXIST</a></a></strong><a name="::ClaraServ::FCT::DB:DATA:EXIST"></a> { DB DATA } {
	set DB_FILE		&quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(15)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/${DB}.db&quot;
	if { ![file exist ${DB_FILE}] } { return &quot;-1&quot;; }
	set FILE_PIPE	[open ${DB_FILE} r];
	while { ![eof ${FILE_PIPE}] } {
		gets ${FILE_PIPE} FILE_DATA;
		if { [string match -nocase ${DATA} ${FILE_DATA}] } {
			close ${FILE_PIPE};
			return 1;
		}
	}
	close ${FILE_PIPE};
	return 0;
}

<strong><a name="::ClaraServ::FCT::DB:SALON:ADD_300">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::DB:SALON:ADD">::ClaraServ::FCT::DB:SALON:ADD</a></a></strong><a name="::ClaraServ::FCT::DB:SALON:ADD"></a> { SALON } {
	if { [string index ${SALON} 0] != &quot;#&quot; } { return 0; }
	if { [<a name="::ClaraServ::FCT::DB:DATA:EXIST(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:DATA:EXIST_285">::ClaraServ::FCT::DB:DATA:EXIST</a></a> &quot;salon&quot; ${SALON}] == 0 } {
		set DB_FILE		&quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(16)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/salon.db&quot;
		set FILE_PIPE	[open ${DB_FILE} a];
		puts ${FILE_PIPE} ${SALON};
		close ${FILE_PIPE};
		return 1;
	} else {
		return -1;
	}
}

<strong><a name="::ClaraServ::FCT::DB:DATA:REMOVE_313">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::DB:DATA:REMOVE">::ClaraServ::FCT::DB:DATA:REMOVE</a></a></strong><a name="::ClaraServ::FCT::DB:DATA:REMOVE"></a> { DB DATA } {
	set DB_FILE			&quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(17)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/${DB}.db&quot;
	if { ![file exist ${DB_FILE}] } { return &quot;-1&quot;; }
	set FILE_PIPE		[open ${DB_FILE} r];
	set STATE			0;
	set FILE_NEW_DATA	[list];
	while { ![eof ${FILE_PIPE}] } {
		gets ${FILE_PIPE} FILE_DATA;
		if { [string match -nocase ${DATA} ${FILE_DATA}] } {
			set STATE		1;
		} elseif { ${FILE_DATA} != &quot;&quot; } {
			lappend FILE_NEW_DATA ${FILE_DATA};
		}
	}
	close ${FILE_PIPE}
	set FILE_PIPE		[open ${DB_FILE} w+];
	foreach LINE_NEW ${FILE_NEW_DATA} { puts ${FILE_PIPE} ${LINE_NEW} }
	close ${FILE_PIPE}
	return ${STATE};
}
<font color="#208020">####################</font>
<font color="#208020">#--&gt; Procedures &lt;--#</font>
<font color="#208020">####################</font>
<strong><a name="::ClaraServ::FCT::Socket:Connexion_336">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::FCT::Socket:Connexion">::ClaraServ::FCT::Socket:Connexion</a></a></strong><a name="::ClaraServ::FCT::Socket:Connexion"></a> {} {
	global ::ClaraServ::config
	variable CONNECT_ID
	variable BOT_ID

	if { ${config(uplink_ssl)} == 1		} { set config(uplink_port) &quot;+${config(uplink_port)}&quot; }
	if { ${config(serverinfo_id)} != &quot;&quot;	} { set config(uplink_ts6) 1 } else { set config(uplink_ts6) 0 }

	set CONNECT_ID [::IRCServices::connection]; <font color="#208020"># Creer une instance services</font>
	${CONNECT_ID} connect ${config(uplink_host)} ${config(uplink_port)} ${config(uplink_password)} ${config(uplink_ts6)} ${config(serverinfo_name)} ${config(serverinfo_id)}; <font color="#208020"># Connexion de l'instance service</font>
	if { ${config(uplink_debug)} == 1} { ${CONNECT_ID} config logger 1; ${CONNECT_ID} config debug 1; }

	set BOT_ID [${CONNECT_ID} bot]; <font color="#208020">#Creer une instance bot dans linstance services</font>

	${BOT_ID} create ${config(service_nick)} ${config(service_user)} ${config(service_host)} ${config(service_gecos)} ${config(service_modes)}; <font color="#208020"># Creation d'un bot service</font>
	${BOT_ID} join ${config(service_channel)}
	${BOT_ID} registerevent EOS {
		global ::ClaraServ::config
		[sid] mode ${config(service_channel)} ${config(service_chanmodes)}
		if { ${config(service_usermodes)} != &quot;&quot; } {
			[sid] mode ${config(service_channel)} ${config(service_usermodes)} ${config(service_nick)}
		}
		set fichier(salon) &quot;[<a name="::ClaraServ::FCT::Get:ScriptDir(18)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::Get:ScriptDir_172">::ClaraServ::FCT::Get:ScriptDir</a></a> &quot;db&quot;]/salon.db&quot;
		set fp	[open ${fichier(salon)} &quot;r&quot;]
		set fc	-1
		while {![eof ${fp}]} {
			set data	[gets ${fp}]
			incr fc
			if { ${data} !=&quot;&quot; } {
				[bid] join ${data}
				if { ${config(service_usermodes)} != &quot;&quot; } {
					[sid] mode ${data} ${config(service_usermodes)} ${config(service_nick)}
				}
			}
			unset data
		}
		close ${fp}

	}
	${BOT_ID} registerevent PRIVMSG {
		set IRC_CMD		[lindex [msg] 0]
		set IRC_VALUE	[lrange [msg] 1 end]

		putlog &quot;PRIVMSG -&gt; $IRC_CMD * $IRC_VALUE&quot;
		<font color="#208020">##########################</font>
		<font color="#208020">#--&gt; Commandes Privés &lt;--#</font>
		<font color="#208020">##########################</font>
		<font color="#208020"># si [target] ne commence pas par # c'est un pseudo</font>
		if { [string index [target] 0] != &quot;#&quot;} {
			<font color="#208020"># Si la commande existe pas, on dit a l'utilisateur qu'elle est inconnue</font>
			if { [info procs ::ClaraServ::IRC:CMD:PRIV:[string toupper ${IRC_CMD}]] == &quot;&quot; } {
				<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(4)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> [who] [format &quot;Commande %s inconnue&quot; ${IRC_CMD}]
				<a name="::ClaraServ::IRC:CMD:PUB:HELP(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::IRC:CMD:PUB:HELP_443">::ClaraServ::IRC:CMD:PUB:HELP</a></a> [who] ${IRC_VALUE}
				return 0;
			}
			<font color="#208020"># au sinon, on l'execute</font>
			if { [catch { set OK [::ClaraServ::IRC:CMD:PRIV:[string toupper ${IRC_CMD}] [who2] [target] ${IRC_CMD} ${IRC_VALUE}] } EXEC_ERROR] } {
				<font color="#208020">#Si il y a une erreur on l'affiche sur le chan log</font>
				foreach line [split ${::errorInfo} &quot;\n&quot;] {
					<a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> ${line}
					putlog ${line} error IRC:CMD:MSG:PRIV
				}
				return 0;
			} else {
				<font color="#208020"># si elle reusi on retourne le status</font>
				return ${OK};
			}
		}
		<font color="#208020">##########################</font>
		<font color="#208020">#--&gt; Commandes Salons &lt;--#</font>
		<font color="#208020">##########################</font>
		<font color="#208020"># si [target] commence par # c'est un salon</font>
		if { [string index [target] 0] == &quot;#&quot;} {
			putlog &quot;test1 =&gt; ::ClaraServ::IRC:CMD:PUB:[string toupper [string range ${IRC_CMD} 1 end]]] &quot;
			<font color="#208020"># Ont verifie si la commande existe</font>
			if { [info procs ::ClaraServ::IRC:CMD:PUB:[string toupper [string range ${IRC_CMD} 1 end]]] != &quot;&quot; } {
				<font color="#208020"># si elle existe ont l'execute</font>
				if { [catch { set OK [::ClaraServ::IRC:CMD:PUB:[string toupper [string range ${IRC_CMD} 1 end]] [who2] [target] ${IRC_CMD} ${IRC_VALUE}] } EXEC_ERROR] } {
					<font color="#208020">#Si il y a une erreur on l'affiche sur le chan log</font>
					foreach line [split ${::errorInfo} &quot;\n&quot;] {
						<a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(3)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> ${line}
						putlog ${line} error IRC:CMD:MSG:PRIV
					}
					return 0;
				}
			}
			<font color="#208020"># Si la commande existe pas en tant que PROC, alors nous verifions si la commande corresponds a une commandes de la database:</font>
			if { [lsearch -nocase [<a name="::ClaraServ::FCT::DB:CMD:LIST(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:CMD:LIST_220">::ClaraServ::FCT::DB:CMD:LIST</a></a>] ${IRC_CMD}] != &quot;-1&quot; } {
				<font color="#208020">#Si la database trouve une corespondance ont execute :</font>
				if { [catch {<a name="::ClaraServ::IRC:CMD:PUB:DYNAMIC(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::IRC:CMD:PUB:DYNAMIC_465">::ClaraServ::IRC:CMD:PUB:DYNAMIC</a></a> [who] [target] ${IRC_CMD} ${IRC_VALUE} } error] } {
					foreach line [split ${::errorInfo} &quot;\n&quot;] {
						<a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(4)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> ${line}
						putlog ${line} error IRC:CMD:MSG:PRIV
					}
				}
			}
		}
	}
	<font color="#208020"># Creer un event sur PRIVMSG fin</font>

}
<font color="#208020">#######################</font>
<font color="#208020">#  --&gt; Commandes &lt;--  #</font>
<font color="#208020">#######################</font>
<strong><a name="::ClaraServ::IRC:CMD:PRIV:HELP_440">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PRIV:HELP">::ClaraServ::IRC:CMD:PRIV:HELP</a></a></strong><a name="::ClaraServ::IRC:CMD:PRIV:HELP"></a> { sender destination cmd data } {
	<a name="::ClaraServ::IRC:CMD:PUB:HELP(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::IRC:CMD:PUB:HELP_443">::ClaraServ::IRC:CMD:PUB:HELP</a></a> ${sender} ${cmd}
}
<strong><a name="::ClaraServ::IRC:CMD:PUB:HELP_443">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PUB:HELP">::ClaraServ::IRC:CMD:PUB:HELP</a></a></strong><a name="::ClaraServ::IRC:CMD:PUB:HELP"></a> { sender cmd } {
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(5)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; .: &lt;c12&gt;Aide publique&lt;c04&gt; :.&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(6)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; &quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(7)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c07&gt; !help   - &lt;c06&gt;  Affiche cette aide&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(8)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c07&gt; !cmds   - &lt;c06&gt;  Affiche la list des commandes&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(9)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c07&gt; !random - &lt;c06&gt;  Affiche un text aleatoire&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(10)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; &quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(11)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; .: &lt;c12&gt;Aide privé&lt;c04&gt; :.&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(12)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; &quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(13)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c07&gt; help    - &lt;c06&gt;  Affiche cette aide&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(14)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c07&gt; join    - &lt;c06&gt;  faire joindre un salon&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(15)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c07&gt; part    - &lt;c06&gt;  faire quitter un salon&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(16)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; &quot;
	<a name="::ClaraServ::FCT::CMD:LOG(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::CMD:LOG_264">::ClaraServ::FCT::CMD:LOG</a></a> ${cmd} ${sender}
}
<strong><a name="::ClaraServ::IRC:CMD:PUB:RANDOM_458">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PUB:RANDOM">::ClaraServ::IRC:CMD:PUB:RANDOM</a></a></strong><a name="::ClaraServ::IRC:CMD:PUB:RANDOM"></a> { sender destination cmd data } {
	variable config
	set CMD_RANDOM	[lindex [<a name="::ClaraServ::FCT::DB:CMD:LIST(3)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:CMD:LIST_220">::ClaraServ::FCT::DB:CMD:LIST</a></a>] [rand [llength [<a name="::ClaraServ::FCT::DB:CMD:LIST(4)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:CMD:LIST_220">::ClaraServ::FCT::DB:CMD:LIST</a></a>]]]]
	if { [catch {ClaraServ::IRC:CMD:PUB:DYNAMIC ${sender} ${destination} ${CMD_RANDOM} ${data} } error] } {
		<a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(5)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;\[ERROR2\] CMD: ${CMD_RANDOM} - Error: ${error}&quot;
	}
}
<strong><a name="::ClaraServ::IRC:CMD:PUB:DYNAMIC_465">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PUB:DYNAMIC">::ClaraServ::IRC:CMD:PUB:DYNAMIC</a></a></strong><a name="::ClaraServ::IRC:CMD:PUB:DYNAMIC"></a> { sender destination cmd pseudo } {
	if { ${pseudo} == &quot;&quot; } {
		set data [<a name="::ClaraServ::FCT::DB:GET(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:GET_208">::ClaraServ::FCT::DB:GET</a></a> ${cmd} 0];
	} else {
		set data [<a name="::ClaraServ::FCT::DB:GET(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:GET_208">::ClaraServ::FCT::DB:GET</a></a> ${cmd} 1];
	}
	if { ${data} != &quot;-1&quot; } {
		set data	[<a name="::ClaraServ::FCT::substitute_special_vars_2nd_pass(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::substitute_special_vars_2nd_pass_191">::ClaraServ::FCT::substitute_special_vars_2nd_pass</a></a> ${destination} ${data}];
		set data	[string map -nocase [list &quot;%pseudo%&quot; &quot;${pseudo}&quot; &quot;%sender%&quot; &quot;${sender}&quot; &quot;%destination%&quot; &quot;${destination}&quot;] ${data}]
		<a name="::ClaraServ::FCT::SENT:PRIVMSG(3)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:PRIVMSG_238">::ClaraServ::FCT::SENT:PRIVMSG</a></a> ${destination} ${data}
	}
	<a name="::ClaraServ::FCT::CMD:LOG(2)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::CMD:LOG_264">::ClaraServ::FCT::CMD:LOG</a></a> ${cmd} ${sender}
}

<strong><a name="::ClaraServ::IRC:CMD:PUB:CMDS_479">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PUB:CMDS">::ClaraServ::IRC:CMD:PUB:CMDS</a></a></strong><a name="::ClaraServ::IRC:CMD:PUB:CMDS"></a> { sender destination cmd data } {
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(17)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; .: &lt;c12&gt;Liste des commandes d'animation&lt;c04&gt; :.&quot;
	<a name="::ClaraServ::FCT::CMD:SHOW:LIST(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::CMD:SHOW:LIST_269">::ClaraServ::FCT::CMD:SHOW:LIST</a></a> ${sender}
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(18)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; .: &lt;c12&gt;Autre&lt;c04&gt; :.&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(19)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c12&gt;!help    &lt;/c&gt;-&lt;c04&gt; Affiche l'aide&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(20)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c12&gt;!random  &lt;/c&gt;-&lt;c04&gt; Affiche un text aleatoire&quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(21)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt; &quot;
	<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(22)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;&lt;c04&gt;  * &lt;b&gt;Note:&lt;/b&gt; Il y a certaine commandes qui ne sont pas activées sur tous les salons.&quot;
	<a name="::ClaraServ::FCT::CMD:LOG(3)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::CMD:LOG_264">::ClaraServ::FCT::CMD:LOG</a></a> ${cmd} ${sender}
}
<font color="#208020">##########################################</font>
<font color="#208020"># --&gt; Procedures des Commandes Privés &lt;--#</font>
<font color="#208020">##########################################</font>
<strong><a name="::ClaraServ::IRC:CMD:PRIV:JOIN_492">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PRIV:JOIN">::ClaraServ::IRC:CMD:PRIV:JOIN</a></a></strong><a name="::ClaraServ::IRC:CMD:PRIV:JOIN"></a> { sender destination cmd data } {
	variable config
	variable ::ClaraServ::FCT::BOT_ID
	set chan		[lindex ${data} 0]
	set password	[lindex ${data} 1]
	if { ${password} == &quot;&quot; } {
		<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(23)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;Mauvaise syntaxe: /msg ${config(service_nick)} join #salon admin_password&quot;
	} elseif { ${password} eq &quot;${config(admin_password)}&quot; } {
		if { [<a name="::ClaraServ::FCT::DB:SALON:ADD(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:SALON:ADD_300">::ClaraServ::FCT::DB:SALON:ADD</a></a> ${chan}] == 1} {
			${BOT_ID} join ${chan}
			${BOT_ID} mode ${chan} +${config(service_usermodes)} ${config(service_nick)}
			<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(24)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;AddChan : ${chan}&quot;
			if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(6)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Join :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} &quot;  }
		} else {
			<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(25)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;AddChan : ${chan} | Erreur Non ajouter &quot;
			if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(7)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Join :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} | Erreur Non ajouter &quot; }
		}

	} else {
		<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(26)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;Accés Refusè.&quot;
		if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(8)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Join :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} &lt;/c&gt;-&gt;&lt;c04&gt; Accés Refusè.&quot;  }
	}
}

<strong><a name="::ClaraServ::IRC:CMD:PRIV:PART_516">proc <a href="ClaraServ.tcl-annot.html#::ClaraServ::IRC:CMD:PRIV:PART">::ClaraServ::IRC:CMD:PRIV:PART</a></a></strong><a name="::ClaraServ::IRC:CMD:PRIV:PART"></a> { sender destination cmd data } {
	variable config
	variable ::ClaraServ::FCT::BOT_ID
	<font color="#208020"># /msg clara part #salon lepassquetamisenconf</font>
	set chan		[lindex ${data} 0]
	set password	[lindex ${data} 1]
	if { ${password} == &quot;&quot; } {
		<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(27)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;Mauvaise syntaxe: /msg ${config(service_nick)} part #salon admin_password&quot;
	} elseif { ${password} eq &quot;${config(admin_password)}&quot; } {
		if { [string match -nocase ${config(service_channel)} ${chan}] } {
			<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(28)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;DelChan : ${chan} | Erreur: impossible ${config(service_channel)} est le salon de logs.&quot;
			if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(9)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Part :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} | Erreur: impossible ${config(service_channel)} est le salon de logs.&quot; }
		} elseif { [<a name="::ClaraServ::FCT::DB:DATA:REMOVE(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::DB:DATA:REMOVE_313">::ClaraServ::FCT::DB:DATA:REMOVE</a></a> &quot;salon&quot; ${chan}] == 1 } {
			${BOT_ID} part ${chan}
			<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(29)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;DelChan : ${chan}&quot;
			if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(10)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Part :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} &quot;  }
		} else {
			<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(30)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;DelChan : ${chan} | Erreur Non ajouter &quot;
			if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(11)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Part :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} | Erreur Non suprimer &quot; }
		}


	} else {
		<a name="::ClaraServ::FCT::SENT:MSG:TO:USER(31)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:USER_242">::ClaraServ::FCT::SENT:MSG:TO:USER</a></a> ${sender} &quot;Accés Refusè.&quot;
		if {${config(admin_console)} eq &quot;1&quot;} { <a name="::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG(12)"><a href="./ClaraServ.tcl.html#::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG_251">::ClaraServ::FCT::SENT:MSG:TO:CHAN:LOG</a></a> &quot;&lt;c12&gt;Part :&lt;c04&gt; ${chan} &lt;/c&gt;par &lt;c04&gt;${sender} &lt;/c&gt;-&gt;&lt;c04&gt; Accés Refusè.&quot;  }
	}
}

<a name="::ClaraServ::INIT(1)"><a href="./ClaraServ.tcl.html#::ClaraServ::INIT_123">::ClaraServ::INIT</a></a>
</pre>
<hr>
<font size="-2">
Index by:  <a href="index_main.html#byfilename">file name</a> |
<a href="index_main.html#byprocname">procedure name</a> |
<a href="index_main.html#bycall">procedure call</a> |
<a href="index_annot_full.html">annotation</a><br>
<cite>Index generated 2022-08-07 at 01:48.</cite>
</font>
</body>
</html>
